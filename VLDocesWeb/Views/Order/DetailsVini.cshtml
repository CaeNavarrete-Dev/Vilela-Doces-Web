@model VLDocesWeb.Models.Order
@{
    Layout = "_Layout";
    ViewData["Title"] = "Detalhes do Pedido";

    // Recupera a lista de itens passada pelo Controller
    var items = ViewBag.OrderItems as List<VLDocesWeb.Models.OrderItemViewModel>;
    
    // Função para traduzir o status do pedido (copiada do ListOrder.cshtml)
    string TraduzStatus(int status)
    {
        return status switch
        {
            0 => "Em análise",
            1 => "Confirmado",
            2 => "Cancelado",
            3 => "Pronto p/ retirada",
            4 => "Negado",
            5 => "Finalizado",
            _ => "Desconhecido"
        };
    } 
}

<a href="~/Order/History" class="btn btn-outline-secondary btn-lg mb-2" tabindex="-1" role="button">
    <i class="bi bi-arrow-left"></i> Voltar
</a>

<div class="container my-4">

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <h5 class="fw-semibold mb-2">Pedido nº @Model.Id</h5>
            <p class="text-muted mb-1">
                Realizado em: 
                <span class="fw-semibold">
                    @Model.Data.ToString("dd MMMM yyyy") 
                    às @Model.Data.ToString("HH:mm")
                </span>
            </p>
            <p class="text-muted mb-0">
                Status: 
                <span class="fw-semibold text-dark">
                    @TraduzStatus(Model.Status)
                </span>
            </p>
            @if (Model.Status == 0) // Status 0 é "Em análise"
            {
                <hr class="my-3"/>
                <div class="text-end">
                    <a href="~/Order/Cancel/@Model.Id" class="btn btn-danger">
                        <i class="bi bi-x-circle"></i> Cancelar Pedido
                    </a>
                </div>
            }
        </div>
    </div>

    @if (items != null && items.Any())
    {
        @foreach (var item in items)
        {
            <div class="card shadow-sm border-0 mb-3">
                <div class="row g-0 align-items-center">
                    <div class="col-md-2 text-center">
                        <img src="~/lib/produto1.png" class="img-fluid p-2 rounded" alt="@item.NomeProduto">
                    </div>
                    <div class="col-md-7">
                        <div class="card-body">
                            <h6 class="fw-semibold mb-1">@item.NomeProduto</h6>
                            <p class="text-muted small mb-1">Quantidade: @item.Quantidade</p>
                            <p class="fw-semibold text-dark mb-0">
                                @item.Subtotal.ToString("C") 
                                (@item.PrecoUnitario.ToString("C") unit.)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="alert alert-warning text-center">Nenhum item encontrado para este pedido.</div>
    }
    
    <div class="card shadow-sm border-0 mt-4">
        <div class="card-body">
            <h6 class="fw-semibold mb-3">Resumo do Pedido</h6>
            <div class="d-flex justify-content-between">
                <span>Subtotal:</span>
                <span>@Model.Total.ToString("C")</span> 
            </div>
            <div class="d-flex justify-content-between">
                <span>Frete:</span>
                <span>R$ 0,00</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between fw-semibold">
                <span>Total:</span>
                <span>@Model.Total.ToString("C")</span>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="~/Order/History" class="btn btn-outline-primary">Voltar aos pedidos</a>
    </div>

</div>